<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>LangGraph | Quinn&#39;s Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="本文详细介绍了LangGraph的主要技术
https://www.cloudwego.io/zh/docs/eino/overview/eino_open_source/">
    <meta name="generator" content="Hugo 0.147.3">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/blog/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >




    


    
      

    

    

    
      <link rel="canonical" href="https://quinnw7.github.io/blog/tech/work/langgraph/">
    

    <meta property="og:url" content="https://quinnw7.github.io/blog/tech/work/langgraph/">
  <meta property="og:site_name" content="Quinn&#39;s Blog">
  <meta property="og:title" content="LangGraph">
  <meta property="og:description" content="本文详细介绍了LangGraph的主要技术 https://www.cloudwego.io/zh/docs/eino/overview/eino_open_source/">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech">
    <meta property="article:published_time" content="2025-08-04T16:58:00+08:00">
    <meta property="article:modified_time" content="2025-08-04T16:58:00+08:00">

  <meta itemprop="name" content="LangGraph">
  <meta itemprop="description" content="本文详细介绍了LangGraph的主要技术 https://www.cloudwego.io/zh/docs/eino/overview/eino_open_source/">
  <meta itemprop="datePublished" content="2025-08-04T16:58:00+08:00">
  <meta itemprop="dateModified" content="2025-08-04T16:58:00+08:00">
  <meta itemprop="wordCount" content="219">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="LangGraph">
  <meta name="twitter:description" content="本文详细介绍了LangGraph的主要技术 https://www.cloudwego.io/zh/docs/eino/overview/eino_open_source/">

      
    
	
  </head><body class="ma0 garamond bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/blog/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Quinn&#39;s Blog
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/" title="Home page">
              Home
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/tech" title="Tech page">
              Tech
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/read" title="Read page">
              Read
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/stock" title="Stock page">
              Stock
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/life_coach" title="Life Coach page">
              Life Coach
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/diary" title="Diary page">
              Diary
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Tech
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">LangGraph</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-08-04T16:58:00+08:00">August 4, 2025</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>本文详细介绍了LangGraph的主要技术
<a href="https://www.cloudwego.io/zh/docs/eino/overview/eino_open_source/">https://www.cloudwego.io/zh/docs/eino/overview/eino_open_source/</a></p>
<p>核心哲学：图 = 状态 + 节点 + 边
所有 Agent 工作流都被建模为“图”（Graph），而图由三个核心组件构成：</p>
<p>1.状态 (State):</p>
<ul>
<li>是什么： 一个共享的数据结构，代表了你的应用在任意时刻的快照。可以把它想象成一个所有节点都能读写的中央白板。</li>
<li>为什么重要： 这是数据在整个图中流动和演变的载体。所有节点的输入都来自这个状态，所有节点的输出都是对这个状态的更新。</li>
</ul>
<p><img src="img.png" alt="img.png">
1.1 状态模式 (Schema)
你必须为状态定义一个结构。最推荐的方式是使用 TypedDict，但同样支持 Pydantic BaseModel（提供运行时验证，但性能稍低）和 dataclass（提供默认值）。</p>
<ul>
<li>多模式 (Multiple Schemas): 这是一个高级但强大的功能。一个图可以有不同的输入、输出和内部状态模式。</li>
<li>输入/输出模式：可以限制用户调用图时只能传入或看到部分状态字段。</li>
<li>私有状态：节点之间可以传递一些“内部沟通”用的数据，而这些数据对外部是不可见的。
1.2 Reduce - 状态更新的核心机制</li>
<li>是什么： Reducer 是一个函数，它定义了如何将一个节点返回的更新应用到主状态的特定字段上。状态中的每个字段（key）都可以有自己的 Reducer。</li>
<li>默认 Reducer： 如果你不指定，默认的 Reducer 就是“覆盖”。例如，如果当前状态是 {&ldquo;foo&rdquo;: 1, &ldquo;bar&rdquo;: [&ldquo;a&rdquo;]}，一个节点返回 {&ldquo;foo&rdquo;: 2}，那么新状态就是 {&ldquo;foo&rdquo;: 2, &ldquo;bar&rdquo;: [&ldquo;a&rdquo;]}。foo 的值被直接覆盖了。</li>
<li>自定义 Reducer (Annotated)： 这才是强大的地方。通过 typing.Annotated，你可以为某个字段指定一个不同的更新函数。最经典的例子是对话历史：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Annotated
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> operator <span style="color:#f92672">import</span> add
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">State</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># foo 字段使用默认的覆盖逻辑</span>
</span></span><span style="display:flex;"><span>    foo: int
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># bar 字段使用 operator.add 作为 reducer</span>
</span></span><span style="display:flex;"><span>    bar: Annotated[list[str], add] 
</span></span></code></pre></div><p>2.节点 (Nodes):</p>
<ul>
<li>是什么： 执行具体任务的 Python 函数。它们是图中的“工作人员”。</li>
<li>为什么重要： 节点是真正干活的地方。一个节点接收当前的状态，执行计算（比如调用 LLM、访问数据库、运行代码），然后返回一个状态更新包。</li>
</ul>
<p>节点是接收图状态（state）作为输入的 Python 函数（同步或异步）。除了 state，它还可以选择性地接收 config 和 runtime 两个参数：
config: 一个 RunnableConfig 对象，包含了线程ID（thread_id）、标签（tags）等可配置的运行时信息
runtime: 一个 Runtime 对象，包含了传递给图的运行时上下文信息，例如数据库连接、模型名称等
<img src="img_1.png" alt="img_1.png">
1.Node Caching节点缓存</p>
<p>核心思想是避免重复执行昂贵的计算
编译图时指定一个缓存实例 cache=InMemoryCache()
精确地告诉 LangGraph 哪些节点应该被缓存，以及如何缓存 cache_policy=CachePolicy(ttl=3)</p>
<ul>
<li>key_func：决定了“什么算作相同的输入”。默认行为通常足够好。当节点被调用时，LangGraph 会运行 key_func，将节点的输入数据作为参数。LangGraph 会用这个键去缓存系统中查找是否存在已存的结果
<ul>
<li>默认行为：如果你不提供自己的 key_func，LangGraph 会使用 pickle 库将整个输入对象序列化，然后计算其哈希值。这意味着，只有当两次调用的输入数据一模一样时，生成的键才会相同，缓存才会命中。</li>
<li>何时自定义：在某些高级场景下，你可能只想根据输入的一部分来创建缓存键</li>
</ul>
</li>
<li>ttl：决定了结果的“保鲜期”。对于会变化的数据源，设置一个合理的 ttl 至关重要</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing_extensions <span style="color:#f92672">import</span> TypedDict
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langgraph.graph <span style="color:#f92672">import</span> StateGraph
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langgraph.cache.memory <span style="color:#f92672">import</span> InMemoryCache
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langgraph.types <span style="color:#f92672">import</span> CachePolicy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">State</span>(TypedDict):
</span></span><span style="display:flex;"><span>    x: int
</span></span><span style="display:flex;"><span>    result: int
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder <span style="color:#f92672">=</span> StateGraph(State)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expensive_node</span>(state: State) <span style="color:#f92672">-&gt;</span> dict[str, int]:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># expensive computation</span>
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;result&#34;</span>: state[<span style="color:#e6db74">&#34;x&#34;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder<span style="color:#f92672">.</span>add_node(<span style="color:#e6db74">&#34;expensive_node&#34;</span>, expensive_node, cache_policy<span style="color:#f92672">=</span>CachePolicy(ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>builder<span style="color:#f92672">.</span>set_entry_point(<span style="color:#e6db74">&#34;expensive_node&#34;</span>)
</span></span><span style="display:flex;"><span>builder<span style="color:#f92672">.</span>set_finish_point(<span style="color:#e6db74">&#34;expensive_node&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>graph <span style="color:#f92672">=</span> builder<span style="color:#f92672">.</span>compile(cache<span style="color:#f92672">=</span>InMemoryCache())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(graph<span style="color:#f92672">.</span>invoke({<span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">5</span>}, stream_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;updates&#39;</span>))  
</span></span><span style="display:flex;"><span>[{<span style="color:#e6db74">&#39;expensive_node&#39;</span>: {<span style="color:#e6db74">&#39;result&#39;</span>: <span style="color:#ae81ff">10</span>}}]
</span></span><span style="display:flex;"><span>print(graph<span style="color:#f92672">.</span>invoke({<span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">5</span>}, stream_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;updates&#39;</span>))  
</span></span><span style="display:flex;"><span>[{<span style="color:#e6db74">&#39;expensive_node&#39;</span>: {<span style="color:#e6db74">&#39;result&#39;</span>: <span style="color:#ae81ff">10</span>}, <span style="color:#e6db74">&#39;__metadata__&#39;</span>: {<span style="color:#e6db74">&#39;cached&#39;</span>: <span style="color:#66d9ef">True</span>}}]
</span></span></code></pre></div><p>3.边 (Edges):</p>
<ul>
<li>是什么： 连接节点的路径，决定了工作流的方向。它们是图中的“流程控制器”或“路由规则”。</li>
<li>为什么重要： 边决定了在一个节点完成后，接下来应该执行哪个节点。这可以是固定的路径（A 总是到 B），也可以是根据当前状态动态判断的条件路径（如果状态满足 X，则去 B；否则去 C）。</li>
</ul>
<p><img src="img_2.png" alt="img_2.png"></p>
<p>3.1 Conditional Edges</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>graph<span style="color:#f92672">.</span>add_conditional_edges(<span style="color:#e6db74">&#34;node_a&#34;</span>, routing_function)
</span></span><span style="display:flex;"><span>graph<span style="color:#f92672">.</span>add_conditional_edges(<span style="color:#e6db74">&#34;node_a&#34;</span>, routing_function, {<span style="color:#e6db74">&#34;key1&#34;</span>: <span style="color:#e6db74">&#34;node_b&#34;</span>, <span style="color:#e6db74">&#34;key2&#34;</span>: <span style="color:#e6db74">&#34;node_c&#34;</span>})
</span></span></code></pre></div><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://quinnw7.github.io/blog/" >
    &copy;  Quinn's Blog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
