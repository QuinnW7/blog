<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title> 微信 iOS 小程序开发方案 | Quinn&#39;s Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.147.3">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<<<<<<< HEAD
<link rel="stylesheet" href="/blog/ananke/css/main.min.css" >
=======
<link rel="stylesheet" href="/blog/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >
>>>>>>> 111a3ed350844b204f4a6d8002f64c22334e199c




    


    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/blog/tech/work/006-ios%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">
    

    <meta property="og:url" content="http://localhost:1313/blog/tech/work/006-ios%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">
  <meta property="og:site_name" content="Quinn&#39;s Blog">
  <meta property="og:title" content=" 微信 iOS 小程序开发方案">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech">
    <meta property="article:published_time" content="2025-05-26T08:42:33+08:00">
    <meta property="article:modified_time" content="2025-05-26T08:42:33+08:00">

  <meta itemprop="name" content=" 微信 iOS 小程序开发方案">
  <meta itemprop="datePublished" content="2025-05-26T08:42:33+08:00">
  <meta itemprop="dateModified" content="2025-05-26T08:42:33+08:00">
  <meta itemprop="wordCount" content="903">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content=" 微信 iOS 小程序开发方案">

	
  </head><body class="ma0 garamond bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/blog/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Quinn&#39;s Blog
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/" title="Home page">
              Home
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/tech" title="Tech page">
              Tech
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/read" title="Read page">
              Read
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/essay" title="Essay page">
              Essay
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Tech
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1"> 微信 iOS 小程序开发方案</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-05-26T08:42:33+08:00">May 26, 2025</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="微信-ios-小程序开发方案">微信 iOS 小程序开发方案</h1>
<h2 id="一开发前准备">一、开发前准备</h2>
<h3 id="一注册小程序账号">（一）注册小程序账号</h3>
<ol>
<li>访问微信公众平台（https://mp.weixin.qq.com/ ），使用微信号登录。</li>
<li>点击右上角的“立即注册”按钮，选择“小程序”进行注册。</li>
<li>填写注册信息，如邮箱、密码等，勾选“已阅读协议”，完成注册。</li>
<li>登录注册的邮箱进行验证，待验证通过后，完成注册流程。</li>
<li>完善小程序信息，包括小程序名称、Logo、描述等，添加小程序类目，设置相关领域，并进行备案，备案时需上传身份证信息，并进行微信认证。</li>
</ol>
<h3 id="二安装开发工具">（二）安装开发工具</h3>
<p>从微信公众平台或微信开放文档中选择对应版本的微信开发者工具，下载并安装。打开微信开发者工具，使用微信号登录，创建新项目，填写 AppID（小程序 ID）、项目名称等信息，选择模板或自定义模板开始开发。</p>
<h2 id="二项目目录结构规划">二、项目目录结构规划</h2>
<p>根据用户提供的当前目录结构，我们可以在现有的基础上进行扩展。以下是详细的目录结构规划：</p>
<pre tabindex="0"><code>├── app.js
├── app.json
├── app.wxss
├── pages
│   ├── index
│   │   ├── index.js
│   │   ├── index.json
│   │   ├── index.wxml
│   │   └── index.wxss
│   ├── logs
│   │   ├── logs.js
│   │   ├── logs.json
│   │   ├── logs.wxml
│   │   └── logs.wxss
│   └── wxml
│       ├── index.js
│       ├── index.json
│       ├── index.wxml
│       └── index.wxss
├── project.config.json
├── project.private.config.json
├── sitemap.json
├── utils
│   └── util.js
├── components
│   └── insuranceForm
│       ├── insuranceForm.js
│       ├── insuranceForm.json
│       ├── insuranceForm.wxml
│       └── insuranceForm.wxss
├── data
│   └── products.xlsx
</code></pre><ul>
<li><code>components</code> 目录：用于存放自定义组件，这里创建了 <code>insuranceForm</code> 组件，用于实现表单功能。</li>
<li><code>data</code> 目录：用于存放数据文件，如 <code>products.xlsx</code>，该文件包含保险公司、收益率等信息，用于生成表单中的产品下拉列表。</li>
</ul>
<h2 id="三表单页面设计与实现">三、表单页面设计与实现</h2>
<h3 id="一表单界面设计">（一）表单界面设计</h3>
<p>在 <code>pages/index/index.wxml</code> 文件中设计表单界面，使用 <code>&lt;view&gt;</code>、<code>&lt;input&gt;</code>、<code>&lt;radio-group&gt;</code>、<code>&lt;picker&gt;</code> 等组件构建表单。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- pages/index/index.wxml --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;container&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;form</span> <span style="color:#a6e22e">bindsubmit=</span><span style="color:#e6db74">&#34;onSubmit&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;form-item&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;text</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;label&#34;</span><span style="color:#f92672">&gt;</span>名称：<span style="color:#f92672">&lt;/text&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;input</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;input&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">placeholder=</span><span style="color:#e6db74">&#34;请输入名称&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/view&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;form-item&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;text</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;label&#34;</span><span style="color:#f92672">&gt;</span>年龄：<span style="color:#f92672">&lt;/text&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;input</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;input&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#a6e22e">placeholder=</span><span style="color:#e6db74">&#34;请输入年龄&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/view&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;form-item&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;text</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;label&#34;</span><span style="color:#f92672">&gt;</span>性别：<span style="color:#f92672">&lt;/text&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;radio-group</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;gender&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;radio</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;男&#34;</span><span style="color:#f92672">&gt;</span>男<span style="color:#f92672">&lt;/radio&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;radio</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;女&#34;</span><span style="color:#f92672">&gt;</span>女<span style="color:#f92672">&lt;/radio&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/radio-group&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/view&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;form-item&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;text</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;label&#34;</span><span style="color:#f92672">&gt;</span>交费期间：<span style="color:#f92672">&lt;/text&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;input</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;input&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;paymentPeriod&#34;</span> <span style="color:#a6e22e">placeholder=</span><span style="color:#e6db74">&#34;请输入交费期间&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/view&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;form-item&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;text</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;label&#34;</span><span style="color:#f92672">&gt;</span>年交保费：<span style="color:#f92672">&lt;/text&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;input</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;input&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;annualPremium&#34;</span> <span style="color:#a6e22e">placeholder=</span><span style="color:#e6db74">&#34;请输入年交保费&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/view&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;form-item&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;text</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;label&#34;</span><span style="color:#f92672">&gt;</span>选择产品：<span style="color:#f92672">&lt;/text&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;picker</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;product&#34;</span> <span style="color:#a6e22e">range=</span><span style="color:#e6db74">&#34;{{products}}&#34;</span> <span style="color:#a6e22e">bindchange=</span><span style="color:#e6db74">&#34;bindPickerChange&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;view</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;picker&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>          {{selectedProduct || &#39;请选择产品&#39;}}
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/view&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/picker&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/view&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;button</span> <span style="color:#a6e22e">formType=</span><span style="color:#e6db74">&#34;submit&#34;</span><span style="color:#f92672">&gt;</span>生成计划书<span style="color:#f92672">&lt;/button&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/form&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/view&gt;</span>
</span></span></code></pre></div><h3 id="二表单样式设计">（二）表单样式设计</h3>
<p>在 <code>pages/index/index.wxss</code> 文件中设计表单样式，使用 CSS 选择器设置组件的样式属性。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#75715e">/* pages/index/index.wxss */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">container</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">form-item</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">label</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">font-weight</span>: <span style="color:#66d9ef">bold</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">input</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ccc</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">picker</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ccc</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="三表单逻辑实现">（三）表单逻辑实现</h3>
<p>在 <code>pages/index/index.js</code> 文件中实现表单的交互逻辑，包括数据绑定、事件处理等。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// pages/index/index.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Page</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">products</span><span style="color:#f92672">:</span> [], <span style="color:#75715e">// 产品列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">selectedProduct</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#75715e">// 选中的产品
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">onLoad</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 读取 products.xlsx 文件，获取产品列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 这里需要使用相关库来读取 Excel 文件，示例代码中暂未实现
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setData</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">products</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;产品 A&#39;</span>, <span style="color:#e6db74">&#39;产品 B&#39;</span>, <span style="color:#e6db74">&#39;产品 C&#39;</span>] <span style="color:#75715e">// 假设的产品列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    });
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bindPickerChange</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setData</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">selectedProduct</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">products</span>[<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">detail</span>.<span style="color:#a6e22e">value</span>]
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">onSubmit</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">formData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">detail</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 调用生成计划书的函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">generatePlan</span>(<span style="color:#a6e22e">formData</span>);
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">generatePlan</span>(<span style="color:#a6e22e">formData</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 生成计划书的逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 这里可以根据表单数据生成保险表格图片，并提供下载和导出 Excel 的功能
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;生成计划书:&#39;</span>, <span style="color:#a6e22e">formData</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="四产品下拉列表实现">四、产品下拉列表实现</h2>
<h3 id="一读取-excel-文件">（一）读取 Excel 文件</h3>
<p>使用第三方库（如 <code>xlsx</code>）读取 <code>data/products.xlsx</code> 文件，获取保险公司信息。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">XLSX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;xlsx&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;fs&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 读取 Excel 文件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">workbook</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">readFile</span>(<span style="color:#e6db74">&#39;data/products.xlsx&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheetName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workbook</span>.<span style="color:#a6e22e">SheetNames</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">worksheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workbook</span>.<span style="color:#a6e22e">Sheets</span>[<span style="color:#a6e22e">sheetName</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">sheet_to_json</span>(<span style="color:#a6e22e">worksheet</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 提取保险公司信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">companies</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">item</span> =&gt; <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;保险公司&#39;</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">companies</span>);
</span></span></code></pre></div><h3 id="二将数据传递给表单页面">（二）将数据传递给表单页面</h3>
<p>在 <code>pages/index/index.js</code> 的 <code>onLoad</code> 函数中，将读取到的保险公司信息传递给 <code>products</code> 数组。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// pages/index/index.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Page</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">products</span><span style="color:#f92672">:</span> [], <span style="color:#75715e">// 产品列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">selectedProduct</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#75715e">// 选中的产品
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">onLoad</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 读取 products.xlsx 文件，获取产品列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">XLSX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;xlsx&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;fs&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">workbook</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">readFile</span>(<span style="color:#e6db74">&#39;data/products.xlsx&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheetName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workbook</span>.<span style="color:#a6e22e">SheetNames</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">worksheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workbook</span>.<span style="color:#a6e22e">Sheets</span>[<span style="color:#a6e22e">sheetName</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">sheet_to_json</span>(<span style="color:#a6e22e">worksheet</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">companies</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">item</span> =&gt; <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;保险公司&#39;</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setData</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">products</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">companies</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 其他代码...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span></code></pre></div><h2 id="五生成计划书并展示保险表格图片">五、生成计划书并展示保险表格图片</h2>
<h3 id="一生成保险表格数据">（一）生成保险表格数据</h3>
<p>根据表单数据和产品信息，生成保险表格数据，包括保单年度、当期保费、现金价值、年化单利等字段。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 生成保险表格数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generateInsuranceTable</span>(<span style="color:#a6e22e">formData</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tableData</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">policyYears</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>; <span style="color:#75715e">// 假设保单年度为 20 年
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">annualPremium</span> <span style="color:#f92672">=</span> parseFloat(<span style="color:#a6e22e">formData</span>.<span style="color:#a6e22e">annualPremium</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cashValueRate</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>; <span style="color:#75715e">// 假设现金价值增长率为 5%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">singleInterestRate</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.03</span>; <span style="color:#75715e">// 假设年化单利为 3%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">policyYears</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentPremium</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">annualPremium</span>; <span style="color:#75715e">// 当期保费
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cashValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">annualPremium</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cashValueRate</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">i</span>); <span style="color:#75715e">// 现金价值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">singleInterest</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">annualPremium</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">singleInterestRate</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">i</span>; <span style="color:#75715e">// 年化单利
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">tableData</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">policyYear</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">i</span>, <span style="color:#75715e">// 保单年度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">currentPremium</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">currentPremium</span>, <span style="color:#75715e">// 当期保费
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">cashValue</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cashValue</span>, <span style="color:#75715e">// 现金价值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">singleInterest</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">singleInterest</span> <span style="color:#75715e">// 年化单利
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tableData</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="二将表格数据转换为图片">（二）将表格数据转换为图片</h3>
<p>使用第三方库（如 <code>canvas</code>）将表格数据转换为图片。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 将表格数据转换为图片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">tableDataToImage</span>(<span style="color:#a6e22e">tableData</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">createCanvasContext</span>(<span style="color:#e6db74">&#39;insuranceTableCanvas&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 设置字体和样式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">setFontSize</span>(<span style="color:#ae81ff">14</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">setFillStyle</span>(<span style="color:#e6db74">&#39;#000&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 绘制表头
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">headers</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;保单年度&#39;</span>, <span style="color:#e6db74">&#39;当期保费&#39;</span>, <span style="color:#e6db74">&#39;现金价值&#39;</span>, <span style="color:#e6db74">&#39;年化单利&#39;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">headerX</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">headerY</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cellWidth</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cellHeight</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">headers</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">header</span>, <span style="color:#a6e22e">index</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">fillText</span>(<span style="color:#a6e22e">header</span>, <span style="color:#a6e22e">headerX</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">cellWidth</span>, <span style="color:#a6e22e">headerY</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 绘制表格内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tableData</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">row</span>, <span style="color:#a6e22e">rowIndex</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rowY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">headerY</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">rowIndex</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">cellHeight</span>;
</span></span><span style="display:flex;"><span>    Object.<span style="color:#a6e22e">values</span>(<span style="color:#a6e22e">row</span>).<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">colIndex</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cellX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">headerX</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">colIndex</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">cellWidth</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">fillText</span>(<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">toString</span>(), <span style="color:#a6e22e">cellX</span>, <span style="color:#a6e22e">rowY</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 绘制完成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">draw</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 将 canvas 转换为图片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">canvasToTempFilePath</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">canvasId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;insuranceTableCanvas&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">success</span>(<span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imagePath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">tempFilePath</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;生成图片路径:&#39;</span>, <span style="color:#a6e22e">imagePath</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 显示图片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">previewImage</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">urls</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">imagePath</span>]
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fail</span>(<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;生成图片失败:&#39;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="三在表单页面调用生成图片的函数">（三）在表单页面调用生成图片的函数</h3>
<p>在 <code>pages/index/index.js</code> 的 <code>generatePlan</code> 函数中，调用 <code>generateInsuranceTable</code> 和 <code>tableDataToImage</code> 函数，生成并展示保险表格图片。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// pages/index/index.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Page</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 其他代码...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">generatePlan</span>(<span style="color:#a6e22e">formData</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tableData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">generateInsuranceTable</span>(<span style="color:#a6e22e">formData</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tableDataToImage</span>(<span style="color:#a6e22e">tableData</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="六图片下载和-excel-导出功能实现">六、图片下载和 Excel 导出功能实现</h2>
<h3 id="一图片下载功能">（一）图片下载功能</h3>
<p>在展示保险表格图片的页面，添加下载按钮，点击按钮时调用 <code>wx.downloadFile</code> 和 <code>wx.saveFile</code> 函数实现图片下载。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 下载图片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">downloadImage</span>(<span style="color:#a6e22e">imagePath</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">downloadFile</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">imagePath</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">success</span>(<span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">statusCode</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">saveFile</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">tempFilePath</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">tempFilePath</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">success</span>(<span style="color:#a6e22e">saveRes</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">savedFilePath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">saveRes</span>.<span style="color:#a6e22e">savedFilePath</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;图片下载成功，保存路径:&#39;</span>, <span style="color:#a6e22e">savedFilePath</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">showToast</span>({
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;图片下载成功&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">icon</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;success&#39;</span>
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">fail</span>(<span style="color:#a6e22e">saveErr</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;图片保存失败:&#39;</span>, <span style="color:#a6e22e">saveErr</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">showToast</span>({
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;图片保存失败&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">icon</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;none&#39;</span>
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fail</span>(<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;图片下载失败:&#39;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">showToast</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;图片下载失败&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">icon</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;none&#39;</span>
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="二excel-导出功能">（二）Excel 导出功能</h3>
<p>使用第三方库（如 <code>xlsx</code>）将保险表格数据导出为 Excel 文件。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 导出 Excel 文件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">exportToExcel</span>(<span style="color:#a6e22e">tableData</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">XLSX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;xlsx&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ws</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">json_to_sheet</span>(<span style="color:#a6e22e">tableData</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wb</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">book_new</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">book_append_sheet</span>(<span style="color:#a6e22e">wb</span>, <span style="color:#a6e22e">ws</span>, <span style="color:#e6db74">&#39;保险表格&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wbout</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XLSX</span>.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">wb</span>, { <span style="color:#a6e22e">bookType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;xlsx&#39;</span>, <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;binary&#39;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ArrayBuffer</span>(<span style="color:#a6e22e">wbout</span>.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">view</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(<span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">wbout</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">view</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">wbout</span>.<span style="color:#a6e22e">charCodeAt</span>(<span style="color:#a6e22e">i</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">filePath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">USER_DATA_PATH</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/insurance_table.xlsx&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">getFileSystemManager</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">writeFile</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">filePath</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">filePath</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">buffer</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">success</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Excel 文件导出成功，保存路径:&#39;</span>, <span style="color:#a6e22e">filePath</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">showToast</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Excel 文件导出成功&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">icon</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;success&#39;</span>
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 提供下载链接或提示用户保存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fail</span>(<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Excel 文件导出失败:&#39;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">showToast</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Excel 文件导出失败&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">icon</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;none&#39;</span>
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="三在表单页面调用下载和导出函数">（三）在表单页面调用下载和导出函数</h3>
<p>在展示保险表格图片的页面，添加下载和导出按钮，点击按钮时分别调用 <code>downloadImage</code> 和 <code>exportToExcel</code> 函数。以下是示例代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// pages/index/index.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Page</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 其他代码...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">generatePlan</span>(<span style="color:#a6e22e">formData</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tableData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">generateInsuranceTable</span>(<span style="color:#a6e22e">formData</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tableDataToImage</span>(<span style="color:#a6e22e">tableData</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 下载图片按钮点击事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">showModal</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;操作提示&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;是否下载图片和导出 Excel 文件？&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">success</span>(<span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">confirm</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imagePath</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;生成的图片路径&#39;</span>; <span style="color:#75715e">// 替换为实际的图片路径
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">downloadImage</span>(<span style="color:#a6e22e">imagePath</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">exportToExcel</span>(<span style="color:#a6e22e">tableData</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="七测试与调试">七、测试与调试</h2>
<p>在微信开发者工具中进行预览和测试，确保小程序的功能和性能符合预期。注意测试在不同设备和操作系统上的兼容性。检查表单数据的输入和提交是否正常，产品下拉列表是否正确显示，保险表格图片的生成、下载和 Excel 导出功能是否正常工作。</p>
<h2 id="八提交审核与上线">八、提交审核与上线</h2>
<p>在微信公众平台提交审核申请，填写小程序的基本信息、设置访问权限等。等待微信官方审核通过后，小程序即可正式上线运营。</p><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="http://localhost:1313/blog/" >
    &copy;  Quinn's Blog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
