<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>简历准本版 | Quinn&#39;s Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="以终为始，介绍什么？再去看什么？">
    <meta name="generator" content="Hugo 0.147.3">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/blog/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >




    


    
      

    

    

    
      <link rel="canonical" href="https://quinnw7.github.io/blog/tech/cv/%E5%87%86%E5%A4%87%E7%89%88/">
    

    <meta property="og:url" content="https://quinnw7.github.io/blog/tech/cv/%E5%87%86%E5%A4%87%E7%89%88/">
  <meta property="og:site_name" content="Quinn&#39;s Blog">
  <meta property="og:title" content="简历准本版">
  <meta property="og:description" content="以终为始，介绍什么？再去看什么？">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech">
    <meta property="article:published_time" content="2025-09-10T17:55:00+08:00">
    <meta property="article:modified_time" content="2025-09-10T17:55:00+08:00">

  <meta itemprop="name" content="简历准本版">
  <meta itemprop="description" content="以终为始，介绍什么？再去看什么？">
  <meta itemprop="datePublished" content="2025-09-10T17:55:00+08:00">
  <meta itemprop="dateModified" content="2025-09-10T17:55:00+08:00">
  <meta itemprop="wordCount" content="625">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="简历准本版">
  <meta name="twitter:description" content="以终为始，介绍什么？再去看什么？">

      
    
	
  </head><body class="ma0 garamond bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/blog/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Quinn&#39;s Blog
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/" title="Home page">
              Home
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/tech" title="Tech page">
              Tech
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/read" title="Read page">
              Read
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/stock" title="Stock page">
              Stock
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/life_coach" title="Life Coach page">
              Life Coach
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/diary" title="Diary page">
              Diary
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/blog/product" title="Product page">
              Product
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Tech
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">简历准本版</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-09-10T17:55:00+08:00">September 10, 2025</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>以终为始，介绍什么？再去看什么？</p>
<h1 id="ai搭子">AI搭子</h1>
<h1 id="混元官网">混元官网</h1>
<h1 id="元器智能体创作平台">元器智能体创作平台</h1>
<h1 id="智能体中台">智能体中台</h1>
<h1 id="商业收款平台">商业收款平台</h1>
<p>用户使用</p>
<p>金融业务场景下，对中小商户进行商业收单，平台为商户去调用微信/支付宝相关接口进行下单，商户对已存在的订单进行支付，平台将商户支付的结果返回给商户。我们选择了跨可用区容灾，因为整套流程包含了本地创建订单、调用第三方支付接口进行支付并返回给系统支付结果，本地更新订单状态，再将订单状态返回给商户，防止并发，这一套流程要引入分布式事务。所以要对这个账单进行上锁。系统最重要的就是存储这张订单的状态，这张订单必须要保证分布式事务。为保证商业收单的高可用性，我们需要一个全局高可用的订单存储，采用db存储，但是由于需要经常查单，所以需要一个组件来存储订单到底存在哪了，并且要求其 可用性极高，我们看了一下腾讯云上售卖的产品，没有能满足可用性需求的，所以我们自建了一套双实例多活的kv存储，用来存储订单具体存储到哪个db的信息。订单来了以后，系统通过仲裁服务先进行探测set（目前探测的是db，只要db可用就认为服务可用），进行选主决定订单路由到哪一个set中，确定后，接入层收到一个订单后，接入层到底应该往哪个set写呢，总得有，接入层只功能解耦开，接入层只是用这个路由表。</p>
<p>用户在下订单、订单支付、更新订单状态，发送订单消息，要保证一起成功或者一起失败，必须是一个整体性的事务。强隔离性的分布式事务。try-confimr-cancel，三个流程，预留资源、提交、取消订单。</p>
<p><strong>实例间通过mq进行信息同步，保证双实例中都有数据</strong>。正常情况下，应该只有1个kv中有消息。用mq去同步消息。</p>
<p>读数据的时候随机读取一个实例，如果有数据就直接返回，如果mq挂了，采用异构db去。</p>
<p>下单但还没有执行成功？</p>
<p>我们平台会生成一个订单号，去调用第三方接口时，第三方也会生成一个订单号。那为了避免的用户重复下单重复支付。我们这边会生成幂等性订单号，第三方接口也是有幂等性的。</p>
<p>最简单的实现：</p>
<p>系统订单都以db中记录为准。查单也是去db中查。</p>
<p>更新订单状态其实就是修改db中数据。</p>
<h2 id="queryorder有两个timer">queryorder有两个timer</h2>
<p>1、CheckTdmqTimerHandle</p>
<p>获取订单列表-&gt;</p>
<p>timer做2，1做流程是没有任何意义。</p>
<p>KV 中开启分布式事务，</p>
<p>分布式事务包含：</p>
<p>1、本地创建订单</p>
<p>2、请求第三方支付平台</p>
<p>3、更新单据</p>
<p>4、解锁订单</p>
<p>5、发送订单消息</p>
<p>![](/Users/quinn/Library/Application Support/typora-user-images/image-20220321102322403.png)</p>
<p>目前系统采用的是tcc，最终一致的方案。事务补偿方案，</p>
<p>本打算使用的是事务消息，但是公司内的tdmq暂时不支持。消息事务反查功能，先提交半消息，对消费者不可见，进行执行，成功则提交commit，失败则删除消息。提供消息反查能力，业务实现一个反查接口，消息队列在调用反查接口得知成功与否。</p>
<p>最简单的方法是把所有订单往一个db中下单，但会有单点故障，跨可用区的db，那么下单是就要实现负载均衡，需要一个全局的存储记录我的订单到底派到哪去了，负载均衡有很多方法，要有高可用的。云上组件都达不到级别。主备、双实例多活。</p>
<h3 id="免密支付需要输入密码支付">免密支付、需要输入密码支付</h3>
<h3 id="分布式事务常见方式">分布式事务常见方式</h3>
<p>tcc</p>
<p>事务型消息记录到这个消息的时候不断的往下做，把他推到一定的状态，每个中间过程是通过事务消息实现的。一旦下游拿到了这个消息就说明它的上游一定是成功的，那么对于它而言它就是把这个消息做完就可以了，对于它而言，方法是一样的，也是一个半提交，然后就去干活，用半提交的反差能力再做。现在没有用半提交的能力，那就先写一行log再去做，潜台词所有操作是幂等的，当我看到这条日志，我不知道是这个活没做的时候就跪了还是已经做完的时候跪了，我只需要重做一遍就可以了，只要保证所有操作都是幂等的。</p>
<p>分布式事务一定是对事务的更新保持一致，我们系统中最重要的两次更新，是我们数据中的订单记录和提供给微信支付的订单记录，这两个订单记录必须是一致的，就是我们是成功的他们就是成功的，我们是失败的他们就是失败的，不能出现他们是成功的我们是失败的。</p>
<p>不是一个简单的负载均衡，我们是要保证当一方故障的时候，另一边有完整数据。所以他是双活方案。</p>
<p>常见的容灾方案有几套：</p>
<p>1、冷备：只有一个实例可用，但是我会定期的把实例的数据dump到冷备中，一旦实例跪了，会重新搭一套资源，然后哦把冷备的数据恢复进来，再使用。但一定会造成服务中断，而且数据会回挡，比如每隔一个小时备份一次。比如说我八点中把数据同步了一下，但是我服务是八点半跪的。那么这时rto和rpo都不等于0</p>
<p>2、热备：只写一个实例，但是不停的往另一个db中写，当一个实例故障时立刻切换实例</p>
<p>3、双活：理论上来讲，可用性最高的一套方案。rpo\rto都是0。我们可以自己决定怎么写。</p>
<p>4、业务方决定写几次怎么写。写失败再去写。</p>
<h3 id="etcd仲裁服务选主">etcd仲裁服务选主</h3>
<h1 id="飞鹰">飞鹰</h1>
<p>数据模块：</p>
<p>广告主在广告主端页面，广告主发送短信，发送领域会向es发送一条记录，</p>
<h2 id="分布式锁">分布式锁</h2>
<p>CDB锁</p>
<h1 id="质量建设">质量建设</h1>
<p>商业收款平台是属于金融场景，集成微信支付、支付宝等第三方支付机构的开放API，提供开箱即用的聚合支付产品，方便中小商户收款。作为面向B端商户推出的收款产品，可用性的重要性不言而喻。影响可用性的因素众多，比如运行环境的网络、主机故障。内部依赖、外部依赖故障。组件故障。变更引起程序有bug或者操作失误等等。（表达关键的意思：背景，面对问题，这个问题造成的影响，游戏不能玩了，过5分钟再打。付款系统如果5分钟，金融场景就把人夯住，金融场景下可用率，巨大的纠纷引发投诉）</p>
<p>过去我们通过监控平台的实时告警，事件单报障，再改进修复业务这一流程来提高业务质量。但是这种流程我们俗称为救火，这种方式是有局限性的。所以我们需要另外一种更有效的手段去 <strong>量化质量水平</strong> ，对质量数据进行分析，发现质量隐患，在其恶化前预防下来。</p>
<p>对于大多数产品，可用率是基于系统正常运行时间比例计算得出（系统正常时间/系统服务时间），但对于微信这样分布式的海量服务产品，基于时间的可用性通常是毫无意义的，因为系统总是可以处理一定量的用户请求。因此，</p>
<p>要想达到量化质量水平，首先就要确定系统量化的指标。对于API/HTTP服务，我们主要统计“可用率”和“时延”两个指标。我们通过请求成功率来定义可用率即成功请求数/总请求数。时延则是统计p99时延不能超过一个固定阈值，即百分之99的请求的时延都应该小于这个值。</p>
<p>正确：算时间，怎么确定这分钟可不可用？</p>
<p>低于一定的值就是不可用，看这一分钟的接口成功率。每一分钟的调用，千万级，每分钟万级别的999的要求。</p>
<p>整个月是整体算法。</p>
<p>每个服务就是算全天</p>
<p>确定统计这两个指标后，还需要确定这个可用率和p99域值。参考微信侧固定目标值确定方法，全天请求数在[1000万, 1亿)，成功率不低于99.995%*那我们系统就把目标，最后为四个9一个8。p99时延 3s看业务需要的，用户最多等多长时间，平均时延1.8s。各模块根据实际情况自定义。</p>
<p>接下来就是要去确定统计范围。商业收款平台作为一个聚合型支付产品，包含支付、查单、门店管理等很多功能。但是其核心功能就是支付相关的，因为从用户使用的角度来说，最重要的体验就是去商店购物时，店员下了一张订单，用户对订单扫码支付成功，商户收款成功。所以在我们系统中将与支付相关的接口定义为关键接口。可用性设定的99995的目标也是针对这部分请求说的。这些请求在我们系统调用形式上主要分成两种，一种是用户请求即外部接口调用，另一种就是我们系统内部触发调用，比如说timer、mq、crontab。外部接口调用和内部触发调用合在一起组成关键接口的总请求数。</p>
<p>接下来就是收集这些请求数据上报到监控系统，我们采用trpc-go框架提供的拦截器功能，自己实现了一个上报状态码、时延的拦截器。不侵入业务代码，接口请求状态码，在系统调用处上报调用成功或是失败，失败时上报的是各模块自定义的错误码。在配置中区分正常、异常失败码。在拦截器上报数据，统计异常失败率。</p>
<p>最后实现以天级别统计的脚本，从监控系统拉取数据，进行数据处理并写入db。利用报表展示数据。实现数据可视化，每天以邮件形式发一份系统质量日报，让系统各模块负责人看到前一天模块失败数等情况，对于不达标的模块，通知负责人进行排查并反馈是否存在系统异常，及时发现那些没有达到告警数的失败原因，即时处理，发现业务质量问题，最终推动解决或优化与原有的告警工单方式相辅相成，进一步加强保证业务质量。</p>
<p>月指标不达标的进行复盘。</p>
<p>输出形式+规范</p>
<p>口语化表达，书面语。</p>
<p>1、为什么可用性如此重要？一定会投诉</p>
<p>2、科学度量办法，月SLA理论，时延辅助</p>
<p>3、确定阈值 制定每分钟多少，结合调用次数。对应梯度目标。（表达意思不需要具体数据）。低峰、高峰期。</p>
<p>4、梳理关键流程。对关键流程不能遗漏。避免侵入，监控的上报框架化。</p>
<p>5、发日报，建立规范。服务、领域、系统。月指标不达标，总结复盘看。日指标不达标自己看。</p>
<p>实现有一定成本。目前就是算的是全天的。千万级别的，大概是4000万。1440 分钟，平均每分钟2.5万，高峰期乘10，25万，30万左右的量级。高峰时<em>在[10万, 100万)，成功率不低于99.95%</em>  150次失败。</p>
<p>月达标99.99，4分钟。</p>
<p><strong>月达标 99.95，20分钟</strong>。平时金融，9999整个接口成功率。</p>
<p>按每分钟更严苛。刚好那一分钟失败，高峰、低峰按分钟算时权重是一样的。权重分开。</p>
<p>统一口径。</p>
<p>低峰、高峰期。统计脚本变一下。</p>
<p>统一口径不同。更早的做法，更宽松。</p>
<p>非关键接口判别条件：支付相关接口2倍以上的接口。</p>
<p>数据流处理服务（Data Pipeline）至少从“完整性”，“新鲜度”两个维度进行SLI和SLO的制定</p>
<p><strong>监控数据，根据配置的算法得到不同业务的质量指标</strong>，以达到量化业务质量的目的 我们可以各种数据分析的手段，发现业务质量问题，最终推动解决或优化 与原有的事件驱动方式相辅相成，进一步加强保证业务质量。</p>
<p>业界的数据运营是大概分 <strong>数据建设、数据分析以及数据报表</strong> 这几部分 指标系统也是这么做的 数据建设里面主要是接入左边的基础数据，进行数据处理 而数据分析主要针对数据提供可视化和算法分析的功能 最后得到分析结果后，输出到数据报表并送达到指定关注人群。</p>
<p>系统每天10点会按照产品分类自动输出可用性日报，每天展示关键接口可用性、全部请求可用性。</p>
<p>就是用户请求数据路由到access层，内部触发数据有消息队列 定时器、crontab。</p>
<p>质量建设，分为数据流和api调用。对于一些典型的场景对应到我们的系统就是用户请求数据路由到access层，内部触发数据有消息队列 定时器、crontab。外部调用接口和内部逻辑触发模块合在一起组成了成功率。系统每天生成一份可用性日报统计系统可用率，全部接口的还有各模块的成功失败率。首先梳理内部关键接口，对于支付系统来说就是在支付链路上的接口。首先确定阈值，，</p>
<p>我们需要另外一种更有效的手段去 <strong>量化质量水平</strong> ，对质量数据进行分析，发现质量隐患，在其恶化前预防下来。</p>
<p>服务从处理形式上主要分为</p>
<p>API/HTTP服务至少从“可用率”和“时延”上报周期内“足够快”的请求占比。</p>
<p>两个维度进行SLI和SLO的制定；</p>
<p>对接口进行埋上报。</p>
<p>理解拦截器的原理关键点在于理解拦截器的触发时机以及 顺序性</p>
<p>实现了一个trpc-go框架的拦截器，在请求前设置一个空的satitiscode的结构体，其中包含 状态码、接口名称以及维度。</p>
<p>在请求进行的过程中设置请求码（在代码中添加上报），拦截器可以在ctx中拿到状态码上报给agent。</p>
<p>监控、日志追踪、日志、鉴权等场景多用。</p>
<h1 id="安全">安全</h1>
<h2 id="防窃听加密">防窃听：加密</h2>
<p>数据不能在网络上明文传递肯定会被窃听，因此要加密。加密分为对称加密和非对称加密。</p>
<p>对称加密在能够保证密钥传递方式安全的情况下是可以使用的。</p>
<p>但是一般情况下无法直接保证密钥传递安全，这时可以采取用非对称加密的方式交换密钥。「公钥加密，私钥解密」</p>
<p>客户端生成一对公私钥，将公钥明文传递给后台。后台生成对称密钥，用客户端传来的公钥对“对称密钥”进行加密后返回给客户端，客户端拿私钥进行解密后得到对称密钥。然后可用进行数据加密传递。</p>
<p>但是这里可能会有中间人攻击。如果有人在中间自己生成一对公私钥，就能轻而易举得到对称密钥。</p>
<p>因此需要引入证书认证中心（CA），客户端本地生成公私钥，将公钥及自己的信息发送给CA,CA认证后，返回证书，客户端将证书发送给后台。后台拿到证书后去CA认证，没问题的话，用提取出的公钥对本地生成的对称密钥进行加密返回给客户端。</p>
<p>这也是SSL/TLS 协议的原理。https协议就是 HTTP 协议”和“SSL/TLS 协议的组合，因此https可以保证通信协议安全。</p>
<p>前提是CA是被信任的，根证书。</p>
<h2 id="防篡改防抵赖签名哈希">防篡改+防抵赖：签名（哈希）</h2>
<p>保证了通信层面的安全后，不能保证数据被篡改，因为公钥是谁都可以获取到的，所以要引入签名，用「私钥加签，公钥验签」。</p>
<p>非对称加密是为防抵赖，因为私钥只有自己有。私钥签名后我用公钥解密后，就能证明一定是你签的。</p>
<p>这里为了保证数据没有被篡改引入哈希，密文+明文的哈希值。</p>
<h2 id="防重放时间戳随机数">防重放：时间戳+随机数</h2>
<p>重放攻击</p>
<p>时间戳+随机数，时间戳只处理5分钟内的请求。缓存随机数，先查缓存，如果有的话直接丢弃。</p>
<p>结合以上原理，我们研究了一套签名算法。商户通过青蛙APP下单，青蛙此时发送请求给后台，需要携带设备号和签名。</p>
<p>在注册时候，去管控平台生成一对公私钥。要将其公钥一同发给后台，此时用其私钥签名。后台收到请求后用公钥验签。判断timestamp大于一定时间的直接过滤，其次判断随机字串，如果已存在则说明为重放，过滤。本地计算签名并与传来的sign进行对比。使用https协议保证通信协议安全。</p>
<p>签名具体过程：</p>
<p><a href="https://git.woa.com/wheels/knowledge/tree/master/1-%E6%B5%81%E7%A8%8B%E8%A7%84%E8%8C%83/HTTP%E7%AD%BE%E5%90%8D%E8%A7%84%E8%8C%83v2">https://git.woa.com/wheels/knowledge/tree/master/1-%E6%B5%81%E7%A8%8B%E8%A7%84%E8%8C%83/HTTP%E7%AD%BE%E5%90%8D%E8%A7%84%E8%8C%83v2</a></p>
<p>签名工具：</p>
<p><a href="https://git.woa.com/sephixiao/trpc-go-util/tree/master/serversignature">https://git.woa.com/sephixiao/trpc-go-util/tree/master/serversignature</a></p>
<p>SSL四次握手：1、你的证书是啥？2、我的证书3、本地验证证书没问题，发送用提取的公钥进行加密的对称密钥4、ok</p>
<p>![image-20220324212744044](/Users/quinn/Library/Application Support/typora-user-images/image-20220324212744044.png)</p>
<h2 id="常见加密算法">常见加密算法</h2>
<p>对称加密算法：<strong>AES256</strong></p>
<p>​	●分组加密算法，密钥长度固定，将明文切分成和密钥长度相同的组，按组进行加密运算</p>
<p>​		DES/3DES，密钥长度只有56/112</p>
<p>​		TEA，密钥长度为128</p>
<p>​		AES密钥长度可以指定为128，192或256</p>
<p>​	●流加密算法，用密钥和伪随机函数生成不短于明文的加密数据流，按位进行加密运算</p>
<p>​		RC4</p>
<p>​		ChaCha20</p>
<p>非对称加密算法：<strong>RSA2048</strong>，ECC</p>
<p>●整数分解</p>
<p>​	●RSA，密钥长度为1024，2048，3072，4096&hellip;</p>
<p>●离散对数</p>
<p>​	DSA基于整数有限域离散对数问题，主要用于签名</p>
<p>​	ECC基于椭圆曲线中的离散对数问题，密钥长度为224即可达到RSA2048一样的强度</p>
<p><strong>哈希函数可以校验完整性</strong>：密文+明文哈希值</p>
<p>​	●MD5，输出128位</p>
<p>​	●SHA-1，输出160位</p>
<p>​	●SHA256，输出256位</p>
<p>加签名是为了防止篡改。</p>
<p>https协议如何保证通信的安全的？</p>
<p>SSL（Secure Sockets Layer）译为「安全套接字协议」，TLS（Transport Layer Security）译为「传输层安全性协议」。</p>
<p>https协议就是 HTTP 协议”和“SSL/TLS 协议的组合，HTTP协议以明文方式发送内容，不提供任何方式的数据加密，HTTPS在HTTP的基础上加入了SSL协议，SSL依靠证书来验证服务器的身份，并为客户端和后台之间的通信加密。</p>
<p>具体协议包含哪些部分？</p>
<p><strong>商户id\金钱，按acsii码的方式排列起来，加上ts\nonce</strong></p>
<p>1、为了保证协议层的安全，我们使用了Https。原理？证书？</p>
<p>2、nonce，timestamp设计是干什么用的？</p>
<p>nonce	为了防止重放，不可重复的。要缓存，不能无限缓存，保留最近5分钟的缓存。</p>
<p>5分钟内处理。本地时间不对，用不了。</p>
<p>3、业务层面保证安全？</p>
<p>知道你是谁？&ndash;使用签名。防抵赖，私钥签名，公钥验签。</p>
<p>陷阱：</p>
<p>1、私钥被获取了？肯定就不安全了。一直谈的通信层的安全，网络传输上的安全，不是终端的安全。</p>
<p>2、私钥怎么保护？</p>
<p>机构的私钥怎么保护？密钥管理系统KMS，安全硬件。</p>
<p><a href="https://iwiki.woa.com/pages/viewpage.action?pageId=342876198">https://iwiki.woa.com/pages/viewpage.action?pageId=342876198</a></p>
<h1 id="统一研发流程">统一研发流程</h1>
<p>飞鹰项目原来是一个单体应用，随着业务不断发展，单体应用改造成本变大，于是做了微服务改造。微服务拆分？</p>
<p>原有：以往发布的时候是发布在物理机上，当扩缩容时，很不方便，所以业务做了容器化。在单实例扩展资源遭遇瓶颈时，可以配合负载均衡机制实现容器实例的弹性扩展，可以实现快速devops。团队从需求、开发、测试、发布、验收全流程标准管理。需求管理，开发分支与需求绑定，使用aoneflow分支模式：补充，在流水线中引入代码检查，codeReiview，支持灰度发布、无损变更。通过收集日志，添加监控告警完善系统。在云上做到正式环境与其他环境资源隔离，使系统可用性不断提高。</p>
<p>改进后：</p>
<p>发布流程非常不规范，大部分人都有现网变更的权限，都是手动变更。就引起了很多问题，比如有人想变测试环境的实例但是不小心变到正式环境上了，或者测试配置配置上了正式环境了。开发过程中有现网的问题出现，多人协作的问题：单体应用时，功能级残缺，提交了这个功能。</p>
<p>项目使用公司内部平台，在上面使用需求池管理需求，项目经理或产品可以在需求池中直接提交需求并将需求分配到开发人员，需求池支持绑定开发分支，开发同学可以认领自己的需求并绑定feature分支进行开发，开发同学开发完成后提交代码到远程仓库，合并到release分支，流水线监听合并事件自动触发部署到测试环境。开发同学在测试环境上进行测试后，如果没有问题，就可以基于release分支进行发布。发布后将release分支合并到master分支，并将master分支合并进现有的release分支。</p>
<p>实际场景和问题？</p>
<p>建立了标准的分支管理模型，aoneflow</p>
<p>怎么解决生命周期，实现了devops流程。</p>
<p>存在什么样的问题？</p>
<p><strong>1、多团队合作，发布流程，手动变更</strong></p>
<p>建设devops流程，解决对应的问题</p>
<p>选了一个工具平台。建立代码统一管理规范，代码库统一管理，流水线管理，制品库，线上配置文件的管理。部署到k8s上的。引入变更发布流程，审批发布知会。</p>
<p>方案决策：结合实际情况，选择了适合团队的。</p>
<p>Gitflow更多人开源项目</p>
<p>2、正式环境测试环境没有隔离，权限没有控制好。配置不对，数据就乱套了</p>
<p>3、在变更过程中，灰度发布。</p>
<p><strong>4、aoneflow ,相关固定的迭代周期。</strong></p>
<p>trunkbased功能开关,开发过程中现网有新的需求出现。</p>
<p>5、多人协作的问题：代码覆盖，功能残缺。trunkbased，不能应对紧急情况。人少</p>
<p>团队在膨胀，研发流程规范。</p>
<p>收益是什么？</p>
<p>度量方式？</p>
<p>具体case</p>
<p>CICD</p>
<p>持续集成、持续交付、持续部署</p>
<p>持续集成：代码提交到流水线编译通过集成测试</p>
<p>持续交付：生成制品，经过了测试+产品验收，可以发布了。  测试自动化程度？</p>
<p>持续部署：制品不断现网发布，不需要人为的中断</p>
<p>持续运营</p>
<h1 id="下单流程高可用">下单流程高可用</h1>
<p>如果2kv的情况下有一个kv故障另外一个kv key不存在 先认为key就是不存在的
后续造成的数据不一致先告警出来
如果订单不是终态，目前的支付实现方案均可以将订单推送到终态
接入层获取到多个值如果发现不一致可以先查询2个set，以订单终态 + 创建时间早的订单为准</p>
<p>![image-20220320155451943](/Users/quinn/Library/Application Support/typora-user-images/image-20220320155451943.png)</p>
<p>1、同步数据的方式， 序列写状态机， 如何保证主上写的系列和备上一致；</p>
<p>2、结果数据同步，也有顺序的问题要解决；</p>
<p>1、写操作：一次写操作只写一个实例，如果写失败再写另外一个实例</p>
<p>2、读操作：先读一个实例，有结果返回，没有继续读下一个实例</p>
<p>3、数据一致性问题：一个实例故障时，如果刚好发生SET切换，写另外一个实例时，可能会出现</p>
<p>2个实例的数据不一致。这个时候以DB的数据为准（以第三方支付平台）来修复kv的数据。</p>
<p>仲裁服务通知proxy，采取</p>
<p>二阶段的方式，保证不会同时</p>
<p>出现访问2个ckv+</p>
<p>只在proxy服务正常的时候进行切换，增加约束。</p>
<p>调研ckv的方案； 微信支付hadb的方案</p>
<h1 id="mysql常见面试题">Mysql常见面试题</h1>
<h1 id="商品管理mysql设计原则">商品管理mysql设计原则</h1>
<p>InnoDB 支持事务</p>
<h1 id="商品收银">商品收银</h1>
<p>需求功能：青蛙app提供商品收银功能。可以用扫码枪扫描商品条形码就可以在青蛙app上添加商品进行结算。</p>
<p>调用后台接口，商户首先需要提前添加其自定义商品库，也提供一个标准商品库，如果商户还未进行添加其自用的商品库，则会展示标准商品库的商品信息。</p>
<p>商品库中商品有分类标签，系统提供一个默认分类，对未进行分类的商品自动归为默认分类。支持批量删除商品。</p>
<p>棘手的问题：批量删除商品，如果有一个物品删除失败，其余物品如何处理？</p>
<p>数据库事务。</p>
<p>事务四大特征(ACID)</p>
<ul>
<li>原子性(A)：事务是最小单位，不可再分</li>
<li>一致性（C）：事务要求所有的DML语句操作的时候，必须保证同时成功或者同时失败</li>
<li>隔离性(I)：事务A和事务B之间具有隔离性</li>
<li>持久性(D)：是事务的保证，事务终结的标志(内存的数据持久到硬盘文件中)</li>
</ul>
<p>关于事务的一些术语：</p>
<ul>
<li>开启事务：Start Transaction</li>
<li>事务结束：End Transaction</li>
<li>提交事务：Commit Transaction</li>
<li>回滚事务：Rollback Transaction</li>
</ul>
<h3 id="并行事务会引发什么问题">并行事务会引发什么问题？</h3>
<h1 id="ants-go协程池">ants go协程池</h1>
<h1 id="订单高可用流程实现">订单高可用流程实现</h1>
<p>我主要参与负责开发的是青蛙APP与后台。</p>
<p>青蛙app就是普通便利店中都有的收银机器。可以选择扫脸支付，也可以顾客提供“付款码”进行支付。</p>
<p><strong>为保障系统支付订单高可用，消除单点故障导致系统整体不可用的情况。采用跨可用区部署</strong>，每个模块部署4个实例，分属2个可用区。</p>
<p>用户在商店买了东西，店员使用扫码枪扫描商品的二维码，青蛙APP双屏展示，一面是店员看的，一面是顾客看的，顾客在确认商品列表信息后，店员进行下单，这时发起调用商业收款平台的</p>
<p>订单中包括订单号、商品列表的body、金额。</p>
<p>用户展示付款码</p>
<p>青蛙APP读取付款码（这里目前仅支持微信付款码），携带【订单号、付款码、订单金额、店员、sn】等信息调用商业收款平台“刷卡支付”请求，请求到达接入层，接入层查询订单号，根据订单号分可用区，其后续支付流程都是在同一个可用区完成。</p>
<p>系统将订单号-set进行kv存储。</p>
<p><strong>接入层首先要验证机具绑定信息</strong>，再去根据订单号去查询set（kv存储），如果是已经有set了，那可以对set直接进行支付。如果没有set，<strong>对订单号采用一致性哈希算法选择可用区</strong>。然后判断可用区是否可用，（“尝试支付的函数”），查询账单成功或者不存在都认为是可用的。<strong>保存订单号与可用区kv关系</strong>。保存不成功返回失败，否则<strong>进行支付</strong>。</p>
<p>首先判断可用区是否可用，逻辑是用db兜底，db必须可用。</p>
<p>支付逻辑：</p>
<p>校验订单是否过期（2小时），验证机具绑定关系。</p>
<p>创建订单结构体，去db中插入订单。</p>
<p>如果订单已存在，就去查这个订单，判断此订单是否是重入。如果是重入，去读取db中的数据，看下这个订单是不是在终态（支付成功或者支付失败），如果是的话，返回成功并返回订单信息。</p>
<p>如果不是终态或者不存在订单，则记录下当前的状态和数据版本，调用微信支付相关接口，微信支付会返回几个支付情况“成功”、“用户支付中”、“此处状态未决，要继续查单”、“其他一次性失败，直接进入终态”，系统认为“成功”、支付中、失败都不是错误。</p>
<p>只有“需要继续查单”。如果是成功的状态则发消息给tdmq，发成功的情况下才会更新db。发送订单消息 使用tdmq。</p>
<p>不正常的订单添加到另一个队列中。</p>
<h3 id="一致性hash算法">一致性Hash算法</h3>
<p>订单号hash:采用murmur3哈希算法。</p>
<p><a href="https://www.cnblogs.com/lpfuture/p/5796398.html">https://www.cnblogs.com/lpfuture/p/5796398.html</a></p>
<p><a href="https://km.woa.com/group/34294/articles/show/401737?kmref=search&amp;from_page=1&amp;no=5">https://km.woa.com/group/34294/articles/show/401737?kmref=search&amp;from_page=1&amp;no=5</a></p>
<p>如果不是如果是一致性哈希，只有插入的节点的上下游会发生变化其他都不变。</p>
<p>这里还会涉及少量的数据搬迁？缩小了这个困难。扩容会有这个需求，比如有我们有4台服务器，分成4个值域空间，突然发现某个值域空间访问非常密集，在这个值域空间一分为二到两个值域空间，需要把原有值域空间的下半部分节点的信息搬迁到新的节点上，然后才能切换。</p>
<h3 id="如何保证都在同一个可用区">如何保证都在同一个可用区</h3>
<p>对实例打标签，请求时带上这个标签。</p>
<h3 id="仲裁服务探测set可用性">仲裁服务探测set可用性</h3>
<p>尝试支付函数</p>
<p>根据订单号找到DB中对应的天表，在表中进行查询是否有此订单号的记录，看一下set的db是否可用。查询账单成功或者不存在都认为是可用的。</p>
<p>t_pay_order+&ldquo;20060102&rdquo;</p>
<h3 id="订单号">订单号</h3>
<p>1、需要ID Gen来生成订单号，规则为 唯一ID （2位） + 时间戳（毫秒级时间戳13位） + 自增ID（5位）</p>
<p>2、每一次支付，业务方需要先到后台来请求一次订单号，订单号有效期时5分钟，需要5分钟之内发起支付，否则需要重新发起支付</p>
<h3 id="状态机">状态机</h3>
<p>订单：初始化、支付中、成功、失败</p>
<p>![image-20220320212831944](/Users/quinn/Library/Application Support/typora-user-images/image-20220320212831944.png)</p>
<h1 id="通用推荐">通用推荐</h1>
<p>集生态、技术、场景于一体，采用业界领先的AI学习技术和智能推荐算法，基于腾讯多年在超大型场景中积累的最佳实践方法论，助力客户业务实现增长的企业级应用产品。</p>
<p>客户通过控制台上传物料、行为、用户画像等相关数据，后台进行分析处理，</p>
<ul>
<li>产品提供成熟标准化的流程与客户对接，通过SDK接入客户APP端侧行为数据，通过API接口进行推荐结果交互，约3周时间完成全部部署与联调工作。</li>
</ul>
<p>统一研发流程：</p>
<p>1、规范通用推荐研发流程，固化内部CICD流程，输出项目整体的流程要求。</p>
<p>2、RecEngine代码梳理，包含TEG所有线上代码。</p>
<p>3、强制引入代码规范检查，现网服务均接入监控宝，和日志汇。</p>
<p>4、建设项目流水线，经过项目流水线编译发布的模块才能部署到现网。</p>
<p>5、拆分现网环境和非现网环境，回收现网环境的运维权限，避免误操作；</p>
<p>6、确定现网服务的灰度发布方案并固化在智研平台的发布流程。</p>
<p>7、BG内部进行《通用推荐智研一站式实践》分享</p>
<p>8、通用推荐项目评选为智研标杆项目并推广</p>
<p>9、定期输出月报及提交月度提效优秀个人</p>
<p>快速部署：</p>
<p>1、完成接入层和联邦线上服务配置定义和应用定义GitOps改造</p>
<p>2、服务配置以Git作为统一存储点，接入层服务修改配置时不直接操作yaml、七彩石</p>
<p>3、完成接入层和联邦线上服务配置定义和应用定义GitOps改造，使用helm发布现网模块</p>
<p>4、完成iac建设，使用teraform管理云上所用组件，包括kafka\kafka topic\redis\mysql\mongodb</p>
<p>5、完成去七彩石改造，配置统一使用configmap管理</p>
<p>6、中长尾客户接入时，实现自动化部署服务，无需研发人员参与</p>
<p>7、快速部署状态机流转</p>
<p>8、完善gitops管理内部工具provider开发</p>
<p>9、完成信息流多租户模版，通过此模版接入广州日报客户，节省人力成本</p>
<p>10、实现根据部署状态自动调用流水线创建、变配、销毁云上资源及部署k8s服务</p>
<p>11、开发terraform provider实现用gitops管理flume，是客户在创建场景资源时无需手动部署flume</p>
<p>成本目标：</p>
<p>1、成本报表中输出各个业务的成本，1个QPS每月的资源成本，即单位成本不高于330元/月</p>
<p>2、通过运维手段降低TKE，TBDS和Redis的资源使用量。</p>
<p>2、梳理业务成本，输出POC成本优化方案</p>
<p>3、使用terraform统计成本</p>
<p>4、添加低负载资源告警</p>
<p>5、对齐obs成本统计</p>
<p>完成情况：</p>
<p>1、资源成本按业务拆分报表发布,单位成本已达目标。</p>
<p>2、完成离线模块日志接入TKE资源优化。平均cpu峰值使用率达到45%，平均内存峰值使用率达到60%</p>
<p>2、梳理业务成本，完成虎扑POC成本优化方案并按计划实施</p>
<p>3、使用terraform统计成本并梳理业务所使用资源情况，并发送成本日报</p>
<p>4、完成了tke资源使用统计，并发送低负载日报及告警</p>
<p>5、对齐公司云上、云梯资源的成本统计方式，并调整业务成本报表对齐obs成本</p>
<p>监控：</p>
<p>1、完善监控指标和告警策略，输出质量报表。</p>
<p>2、完善监控指标和告警策略。</p>
<p>3、深入了解云监控，建立基于云监控的多维度指标体系。</p>
<p>4、输出通用推荐项目质量日报。</p>
<p>5、梳理主要监控指标，梳理部分重要监控项对应的告警规则、收敛规则，输出表格和告警配置文件。针对后台服务模块，梳理各维度各层级的具体监控项，配置告警。</p>
<p>6、调研云监控Prometheus接入智研监控宝，输出接入指南。</p>
<p>趣头条去重曝光问题修复</p>
<p>控制台：</p>
<p>1、完成电商行业模版开发并上线，包含概览页、效果查运营策略等功能，给李宁、安踏等营销云客户使用</p>
<p>2、完成自动化销毁场景资源及训练平台任务</p>
<p>3、完成计费相关资源创建流水线开发，打通计费流程</p>
<p>4、对客户开放推荐系统核心流程，KA和中长尾客户均可以在控制台特征处理开发</p>
<p>5、支持客户运营策略配置</p>
<p>6、完成特征工程白盒化功能开发</p>
<p>7、完成运营白盒化功能开发并上线，客户运营策略配置，包括去重及打散策略</p>
<h1 id="疑问">疑问</h1>
<p>1、为什么如果通过订单号查到了set，就i直接进行支付，而不确认set是否可用？</p>
<p>​	因为对于初始的订单号来说，一定是走分set的路径，也就是说一定是已经判断过set是可用的了。</p>
<p>2、什么情况下会有同一个订单？</p>
<p>网络抖动？一个请求来了多次。。。</p>
<h2 id="redis">Redis</h2>
<p>常见几种结构：string（字符串），hash（哈希），list（列表），set（集合）及zset(sorted set：有序集合)。</p>
<h3 id="redis分布式锁么">Redis分布式锁么</h3>
<p>先拿<strong>setnx</strong>来争抢锁，抢到之后，再用<strong>expire</strong>给锁加一个过期时间防止锁忘记了释放。</p>
<p>这时候对方会告诉你说你回答得不错，然后接着问如果在setnx之后执行expire之前进程意外crash或者要重启维护了，那会怎么样？</p>
<p>这时候你要给予惊讶的反馈：唉，是喔，这个锁就永远得不到释放了。紧接着你需要<strong>抓一抓自己得脑袋，故作思考片刻</strong>，好像接下来的结果是你主动思考出来的，然后回答：我记得set指令有非常复杂的参数，这个应该是可以同时把<strong>setnx</strong>和<strong>expire</strong>合成一条指令来用的！</p>
<h3 id="key如何将它们找出来">key如何将它们找出来？</h3>
<p>keys</p>
<h3 id="如果这个redis正在给线上的业务提供服务那使用keys指令会有什么问题">如果这个redis正在给线上的业务提供服务，那使用keys指令会有什么问题？</h3>
<p>这个时候你要回答Redis关键的一个特性：Redis的单线程的。keys指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。这个时候可以使用<strong>scan</strong>指令，<strong>scan</strong>指令可以无阻塞的提取出指定模式的key列表，但是会有一定的重复概率，在客户端做一次去重就可以了，但是整体所花费的时间会比直接用keys指令长。</p>
<h1 id="算法">算法</h1>
<h2 id="排序">排序</h2>
<h3 id="1冒泡排序">1、冒泡排序</h3>
<h3 id="2归并排序onlogn">2、归并排序O(nlogn)</h3>
<p>左侧、右侧均有序</p>
<p>比较信息留下来了，变成了整体有序的部分，和更大部分去merge。</p>
<p>两个指针比较的东西放在外面的数组中</p>
<h2 id="链表">链表</h2>
<p>笔试：不在乎空间复杂度</p>
<p>面试：时间复杂度第一位、但一定要找到最省空间的办法</p>
<p>使用容器：栈、数组等</p>
<h3 id="1快慢指针">1、快慢指针</h3>
<p>![image-20220323084226316](/Users/quinn/Library/Application Support/typora-user-images/image-20220323084226316.png)</p>
<p>![image-20220323085128776](/Users/quinn/Library/Application Support/typora-user-images/image-20220323085128776.png)</p>
<p>![image-20220323085250746](/Users/quinn/Library/Application Support/typora-user-images/image-20220323085250746.png)</p>
<p>![image-20220323085309638](/Users/quinn/Library/Application Support/typora-user-images/image-20220323085309638.png)</p>
<p>边界条件是不一样的</p>
<p>没有点、1个点、2个点直接返回head</p>
<h3 id="2回文结构">2、回文结构</h3>
<p>![image-20220323085923647](/Users/quinn/Library/Application Support/typora-user-images/image-20220323085923647.png)</p>
<p>笔试：用栈</p>
<p>![image-20220323090147484](/Users/quinn/Library/Application Support/typora-user-images/image-20220323090147484.png)</p>
<p>1-&gt;2-&gt;3-&gt;4</p>
<p>面试：</p>
<p>过渡版本：快慢指针找中点，然后后半部分放栈</p>
<p>![image-20220323090740997](/Users/quinn/Library/Application Support/typora-user-images/image-20220323090740997.png)</p>
<p>最终版本：</p>
<p>![image-20220323090511648](/Users/quinn/Library/Application Support/typora-user-images/image-20220323090511648.png)</p>
<p>![image-20220323090621551](/Users/quinn/Library/Application Support/typora-user-images/image-20220323090621551.png)</p>
<p>返回之前要调回来。</p>
<p>![image-20220323090826094](/Users/quinn/Library/Application Support/typora-user-images/image-20220323090826094.png)</p>
<h3 id="3链表排序">3、链表排序</h3>
<p>3 -&gt;2 -&gt;4 -&gt;7 -&gt;0 -&gt;2 -&gt;1</p>
<p>0 -&gt;1 -&gt;2 -&gt;2 -&gt;3 -&gt;4 -&gt;7</p>
<h2 id="栈">栈</h2>
<h3 id="20判断括号有效">20.判断括号有效</h3>
<p>对于栈相关问题，需要主要考虑的是：入栈和出栈的逻辑</p>
<p>入栈：左括号</p>
<p>出栈：当遇到右括号时，判断栈顶的元素是不是与之匹配的左括号，如果是，则出栈。</p>
<p>最后判断是否为空字符串</p>
<p>go语言的stack可以用数组实现</p>
<p>入栈：append</p>
<p>出栈：stack=stack[:len(stack)-1]</p>
<p>栈的底层使用数组实现的</p>
<h2 id="线程安全问题">线程安全问题</h2>
<p><a href="https://cloud.tencent.com/developer/article/1836411">https://cloud.tencent.com/developer/article/1836411</a></p>
<p>线程安全：指的是多线程并行执行时对共享变量的处理正确</p>
<h2 id="树">树</h2>
<p>明显口述过程中不表达异常。</p>
<p>总结过程要提炼，要抽象出来问题。</p>
<p>高可用的逻辑：订单调单</p>
<p>下单逻辑存的是什么？</p>
<p>商业收款平台，收单平台做的不是支付，为什么需要我们？</p>
<p>直接用微信转账，个人码就收了。个人码有交易金额限制，流水量很大，商业收款。</p>
<p>商业收款只提供了api，关键在于需要有系统帮助店主下一张订单，终端客户对订单进行支付，然后再给</p>
<p>收单：下一章订单，往微信支付，轮训等待，将结果返回店长。</p>
<p>收的订单必须要保障acid，分布式事务不一致，也不能丢失。</p>
<p>核心存储的支付单信息，</p>
<p>抽象提炼问题。</p>
<p>站高一点，这个系统在做什么？慢慢去想为什么要做成这样？</p>
<h2 id="备用准备">备用准备</h2>
<p>飞鹰项目：</p>
<p>1、负责数据模块，提供对外接口实现广告主端数据展示以及定时任务统计发送、到达短信数。</p>
<p>2021.05-至今 TEG数据平台部 飞鹰智能短信营销平台</p>
<p>项目介绍：</p>
<p>与泰迪熊、梦网等智能短信供应商合作，将原有的文字营销短信升级为图文、音视频等富媒体形态，提升广告转化率。广告主可以在Web页面上编辑短信创意，制定发送计划，并查看转化效果。飞鹰平台在上线5个月内，累计发送1.8亿条智能短信。</p>
<p>个人职责：</p>
<ol>
<li>
<p>负责短信数据领域的开发，提供数据采集，统计和展示等能力。</p>
</li>
<li>
<p>负责项目上云专项，搭建基于云原生的devops研发流程。</p>
</li>
</ol>
<p>2020.08-2021.05 TEG基础架构部 商业收款平台</p>
<p>项目介绍：</p>
<p>集成微信支付、支付宝等第三方支付机构的开放API，提供开箱即用的聚合支付产品，方便中小商户收款。商户可以在Web页面，或小程序上管理门店信息，配置收款产品，以及查看账单。收款平台单日支付订单笔数超过270万，单日支付订单金额超过2.1亿。</p>
<p>个人职责：</p>
<ol>
<li>
<p>负责接入层的研发，提供高可用，低延迟，并且安全可靠的收单服务。</p>
</li>
<li>
<p>负责可用性提升专项，将系统可用率提高到99.998，消除服务不可用隐患。</p>
</li>
</ol>
<p>2、项目持续交付云原生、k8s、统一研发流程。</p>
<p>使用dockerfile打包镜像，deployment多实例部署，ingress进行服务路由，实现自动负载均衡，将多环境资源隔离。使用分布式锁控制多实例定时任务运行。</p>
<p>3、负责接入层开发，功能包括：</p>
<p>下单流程高可用建设，订单set化。</p>
<p>采用HTTP 基于 HMAC-SHA256 的消息认证算法, 保证支付场景的安全。</p>
<p>4、负责系统质量建设，将系统可用率提高到99.998，达到金融场景质量标准。</p>
<p>5、负责商品管理模块采用分布式事务开发，支持批量物品上下架。</p>
<p>golang:</p>
<p><a href="https://www.runoob.com/go/go-basic-syntax.html">https://www.runoob.com/go/go-basic-syntax.html</a></p>
<p>trpc-go:</p>
<p><a href="https://iwiki.woa.com/display/tRPC/tRPC-Go">https://iwiki.woa.com/display/tRPC/tRPC-Go</a></p>
<h2 id="死锁的发生条件">死锁的发生条件</h2>
<p>虽然进程在运行过程中，可能发生死锁，但死锁的发生也必须具备一定的条件，死锁的发生必须具备以下四个<a href="https://baike.baidu.com/item/%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6">必要条件</a>。</p>
<p>**1）互斥条件：**指进程对所分配到的资源进行排它性使用，即在一段时间内某资源只由一个进程占用。如果此时还有其它进程请求资源，则请求者只能等待，直至占有资源的进程用毕释放。</p>
<p>**2）请求和保持条件：**指进程已经保持至少一个资源，但又提出了新的资源请求，而该资源已被其它进程占有，此时请求进程阻塞，但又对自己已获得的其它资源保持不放。</p>
<p>**3）不剥夺条件：**指进程已获得的资源，在未使用完之前，不能被剥夺，只能在使用完时由自己释放。</p>
<p>**4）环路等待条件：**指在发生死锁时，必然存在一个进程——资源的环形链，即进程集合{P0，P1，P2，···，Pn}中的P0正在等待一个P1占用的资源；P1正在等待P2占用的资源，……，Pn正在等待已被P0占用的资源</p>
<h2 id="面试01-csig数据产品组">面试01-CSIG数据产品组</h2>
<p>1、分布式事务tcc：</p>
<p>不回滚，每个中间过程，半提交反查逻辑</p>
<p>看到这条日志，在做一遍事。</p>
<p>2、一致性hash</p>
<p>3、数据库索引失效情况：</p>
<p>4、索引底层的数据结构b+树：</p>
<p>5、Kafka怎么使用的，为什么这么快：</p>
<p>6、redis如果缓存500万的数据，怎么做500M缓存？</p>
<p>本题考查的是算数能力。</p>
<p>假设每条记录100字节=0.1kB=10-4M</p>
<p>就是500M，直接存 一般申请G级别以上</p>
<p>上百G以上才来说其大数据量</p>
<p>逻辑层和数据层要离的很近很近。广州的逻辑层最远访问深圳的数据层。</p>
<p>带宽：一个包1k 返回10k，吞吐量是多少？</p>
<p>常见的网卡是10Gb 的网卡，</p>
<p>7、数据库存储数据量较大的时候应该怎么处理？</p>
<p>分表有什么好处和缺点？</p>
<p>好处就是增加查询效率，方便数据迁移。缺点就是跨表联合查询较慢。</p>
<p>这地方可以分冷热表。</p>
<p>冷表实现形态使用的是磁盘，热表使用的ssd，银行绝大多数查账单都是三个月的。三个月的查询，再联立去查询。</p>
<p>3个月的存在一张表中</p>
<p>历史跨表虽然会慢但是能接受。</p>
<p>常见的数据部分不分表了，在产品上只查最近一周的、一个月的，其余的数据按月分表，p99思想，如果用户查询99的</p>
<p>如果数据有时效性，则建议按时间分表或者分库; 形如 bank 存储用户资金流水，按照年来分表。 数据参考如下：</p>
<ul>
<li>日新增记录行数为[0, 1w），单库单表即可。</li>
<li>日新增记录行数为[1w, 10w)，单库按年分表。</li>
<li>日新增记录行数为[10w, 100w)，单库，按月分表。</li>
<li>日新增记录行数为[100w, 1000w)，按年分库，按天分表。</li>
<li>日新增记录行数为[1000w, +∞)，按月分库，按天分若干张表。</li>
</ul>
<p>如果存储的数据，不具备明显时效性，则建议根据hash或者其他手段分库分表。</p>
<ul>
<li>总记录行数为[0, 1000W)，单库单表。</li>
<li>总记录行数为[1000w, 10000w) ， 单库十表。</li>
<li>总记录行数为[10000w, +∞)，使用百库十表。</li>
</ul>
<h1 id="简历提到的技能">简历提到的技能</h1>
<h2 id="熟悉分布式系统">熟悉分布式系统</h2>
<h3 id="性能优化">性能优化</h3>
<p>1、性能监控：单机版用火焰图分析https://www.brendangregg.com/flamegraphs.html，分布式系统可以通过对日志进行统一结构化处理后HBase，用map reduce分析，使用traceid全链路追踪找出耗时大的接口信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>yum install perf
</span></span><span style="display:flex;"><span>git clone --depth <span style="color:#ae81ff">1</span> https://github.com/brendangregg/FlameGraph.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>perf record -F <span style="color:#ae81ff">99</span> -p 进程PID -g --call-graph dwarf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>perf script &gt; out.perf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FlameGraph/stackcollapse-perf.pl out.perf &gt; out.folded
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FlameGraph/flamegraph.pl out.folded &gt; out.svg
</span></span></code></pre></div><p>On CPU 火焰图/OFF CPU 火焰图</p>
<h2 id="缓存">缓存</h2>
<h2 id="mysql">mysql</h2>
<h2 id="常用性能优化技巧">常用性能优化技巧</h2>
<p><img src="https://static001.geekbang.org/resource/image/e7/3d/e7aef5a7653c2ae6c1060e290a7a343d.jpg?wh=2283*4478" alt="img"></p><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://quinnw7.github.io/blog/" >
    &copy;  Quinn's Blog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
